const translations = {
  es: {
    page_title: 'LXBE Presskit | DJ Afro House',
    page_description:
      'Presskit oficial de LXBE, DJ de Barcelona. Afro House, House, Funky House y Nu Disco para clubs, festivales y eventos privados.',
    og_title: 'LXBE Presskit | DJ Afro House',
    og_description: 'Bio, sonido, mixes, fechas y contacto para bookings de LXBE.',
    nav_aria: 'Navegacion principal',
    menu_toggle: 'Abrir menu',
    nav_about: 'Bio + Sound',
    nav_mixes: 'Mixes',
    nav_instagram: 'Instagram',
    nav_contact: 'Contacto',
    hero_kicker: 'Afro House 路 House 路 Funky House 路 Nu Disco',
    hero_title: 'PRESSKIT',
    hero_text:
      'DJ de Barcelona con sets energicos y emocionales. LXBE mezcla percusion afro, grooves house y momentos vocales para crear pistas de baile con identidad.',
    hero_cta_listen: 'Escuchar mixes',
    hero_cta_book: 'Solicitar booking',
    hero_cta_download: 'Descargar PDF',
    metrics_aria: 'Metricas destacadas',
    metric_shows: 'Shows',
    metric_cities: 'Ciudades',
    metric_residencies: 'Residencias',
    hero_visual_aria: 'Visual artistico de LXBE',
    about_kicker: 'Biography + Sound DNA',
    about_title: 'Historia, identidad y energia',
    bio_p1:
      'Alex, conocido como LXBE, nace y crece en Barcelona rodeado de cultura club y ritmos urbanos. Desde muy joven conecta con la seleccion musical como lenguaje emocional.',
    bio_p2:
      'Su propuesta combina Afro House, House, Funky House y Nu Disco en una narrativa de energia ascendente: arranque elegante, desarrollo hipnotico y cierre explosivo.',
    bio_p3:
      'El objetivo de cada set es claro: generar conexion real entre musica y publico, creando recuerdos fuertes en cada noche.',
    about_tag_1: 'Afro House',
    about_tag_2: 'Club Energy',
    about_tag_3: 'Emotional Journey',
    sound_kicker: 'Sound DNA',
    sound_title: 'Estilo y enfoque',
    sound_card1_title: 'Generos',
    sound_card1_text: 'Afro House, House, Funky House y Nu Disco curados para pista.',
    sound_card2_title: 'Vibe',
    sound_card2_text: 'Sets positivos, bailables y con transiciones limpias orientadas al publico.',
    sound_card3_title: 'Diferencial',
    sound_card3_text: 'Seleccion emocional con estetica contemporanea para clubs y eventos premium.',
    mixes_kicker: 'Featured',
    mixes_title: 'Mixes destacados',
    mix_list_tracks: 'Tracks',
    mix_list_reposts: 'Reposts',
    mix_1_text: 'Sesion con percusion afro y energia de rooftop mediterraneo.',
    mix_2_text: 'Recorrido entre house vocal, groove funky y atmosferas nocturnas.',
    mix_3_text: 'Extracto live con tension progresiva y respuesta real del publico.',
    mix_listen: 'Escuchar',
    ig_kicker: 'Instagram',
    ig_title: 'Contenido DJ',
    ig_intro: 'Seleccion de posts/reels de LXBE en cabina, directos y contenido de club.',
    ig_profile_cta: 'Ver perfil completo en Instagram',
    ig_footprint_title: 'Presencia internacional',
    ig_view_post: 'Ver post original',
    ig_empty:
      'Pasa 3-6 links de posts/reels y los dejo embebidos aqui para reforzar el presskit.',
    contact_kicker: 'Bookings & Media',
    contact_title: 'Contacto',
    contact_mgmt: 'Management',
    contact_location: 'Barcelona, Espana',
    contact_links: 'Enlaces',
    form_name: 'Nombre',
    form_email: 'Email',
    form_org: 'Empresa / Promotora',
    form_message: 'Mensaje',
    form_message_placeholder: 'Comparte detalles del evento, fecha y ciudad',
    form_privacy_consent: 'He leido y acepto la politica de privacidad.',
    form_submit: 'Enviar solicitud',
    press_assets_subject: 'Solicitud Press Assets LXBE',
    legal_kicker: 'Legal',
    legal_title: 'Privacidad y cookies',
    privacy_title: 'Politica de privacidad',
    privacy_text_1:
      'Titular del sitio: persona fisica (LXBE/Alex). Finalidad: gestionar solicitudes de booking y contacto.',
    privacy_text_2:
      'Datos tratados: nombre, email, empresa/promotora y mensaje. Base juridica: consentimiento del usuario.',
    privacy_text_3:
      'Destinatarios: FormSubmit para el envio del formulario y proveedores de hosting. Puedes ejercer derechos por email.',
    cookies_title: 'Politica de cookies',
    cookies_text_1:
      'Esta web utiliza cookies tecnicas necesarias y, solo con consentimiento, contenido embebido de terceros (Instagram/SoundCloud) que puede instalar cookies adicionales.',
    cookies_text_2:
      'Puedes aceptar o rechazar cookies no necesarias desde el banner y cambiar tu eleccion cuando quieras.',
    notice_title: 'Aviso legal',
    notice_text_1:
      'Sitio informativo y de promocion artistica de titular particular. El uso del sitio implica aceptar estas condiciones y la normativa aplicable.',
    notice_text_2: 'Contacto legal y privacidad: hello.alexbemusic@gmail.com.',
    cookie_banner_text:
      'Usamos cookies tecnicas y, con tu permiso, cargamos embeds de terceros (Instagram/SoundCloud).',
    cookie_accept: 'Aceptar',
    cookie_reject: 'Rechazar',
    cookie_manage: 'Gestionar cookies',
    embed_blocked: 'Contenido bloqueado hasta aceptar cookies de terceros.',
    embed_open_original: 'Abrir original',
    footer_privacy: 'Privacidad',
    footer_cookies: 'Cookies',
    footer_notice: 'Aviso legal',
    footer_top: 'Volver arriba',
    footer_copy: 'LXBE 路 Presskit Oficial',
    onesheet_filename: 'LXBE_OneSheet_ES.html',
    onesheet_subtitle: 'Presskit oficial',
  },
  en: {
    page_title: 'LXBE Presskit | Afro House DJ',
    page_description:
      'Official presskit for LXBE, Barcelona-based DJ. Afro House, House, Funky House and Nu Disco for clubs, festivals and private events.',
    og_title: 'LXBE Presskit | Afro House DJ',
    og_description: 'Bio, sound, mixes, dates and booking contact for LXBE.',
    nav_aria: 'Main navigation',
    menu_toggle: 'Open menu',
    nav_about: 'Bio + Sound',
    nav_mixes: 'Mixes',
    nav_instagram: 'Instagram',
    nav_contact: 'Contact',
    hero_kicker: 'Afro House 路 House 路 Funky House 路 Nu Disco',
    hero_title: ' PRESSKIT',
    hero_text:
      'Barcelona DJ delivering energetic and emotional sets. LXBE blends afro percussion, house grooves and vocal moments to shape dancefloors with identity.',
    hero_cta_listen: 'Listen to mixes',
    hero_cta_book: 'Request booking',
    hero_cta_download: 'Download PDF',
    metrics_aria: 'Highlighted metrics',
    metric_shows: 'Shows',
    metric_cities: 'Cities',
    metric_residencies: 'Residencies',
    hero_visual_aria: 'Artistic visual of LXBE',
    about_kicker: 'Biography + Sound DNA',
    about_title: 'Story, identity and energy',
    bio_p1:
      'Alex, known as LXBE, was born and raised in Barcelona surrounded by club culture and urban rhythms. From an early age, music curation became an emotional language.',
    bio_p2:
      'His proposal blends Afro House, House, Funky House and Nu Disco in a rising-energy narrative: elegant opening, hypnotic middle and explosive closing.',
    bio_p3:
      'The goal in every set is clear: create a real connection between music and crowd, building strong memories every night.',
    about_tag_1: 'Afro House',
    about_tag_2: 'Club Energy',
    about_tag_3: 'Emotional Journey',
    sound_kicker: 'Sound DNA',
    sound_title: 'Style and approach',
    sound_card1_title: 'Genres',
    sound_card1_text: 'Afro House, House, Funky House and Nu Disco curated for the dancefloor.',
    sound_card2_title: 'Vibe',
    sound_card2_text: 'Positive, dance-driven sets with clean transitions focused on the crowd.',
    sound_card3_title: 'Edge',
    sound_card3_text: 'Emotional curation with a contemporary aesthetic for clubs and premium events.',
    mixes_kicker: 'Featured',
    mixes_title: 'Featured mixes',
    mix_list_tracks: 'Tracks',
    mix_list_reposts: 'Reposts',
    mix_1_text: 'Session with afro percussion and Mediterranean rooftop energy.',
    mix_2_text: 'Journey across vocal house, funky groove and night atmospheres.',
    mix_3_text: 'Live extract with progressive tension and real crowd response.',
    mix_listen: 'Listen',
    ig_kicker: 'Instagram',
    ig_title: 'DJ Content',
    ig_intro: 'Curated LXBE posts/reels from booth sessions, live clips and club content.',
    ig_profile_cta: 'View full Instagram profile',
    ig_footprint_title: 'International footprint',
    ig_view_post: 'View original post',
    ig_empty: 'Share 3-6 post/reel links and I will embed them here for the presskit.',
    contact_kicker: 'Bookings & Media',
    contact_title: 'Contact',
    contact_mgmt: 'Management',
    contact_location: 'Barcelona, Spain',
    contact_links: 'Links',
    form_name: 'Name',
    form_email: 'Email',
    form_org: 'Company / Promoter',
    form_message: 'Message',
    form_message_placeholder: 'Share event details, date and city',
    form_privacy_consent: 'I have read and accept the privacy policy.',
    form_submit: 'Send request',
    press_assets_subject: 'LXBE Press Assets Request',
    legal_kicker: 'Legal',
    legal_title: 'Privacy and cookies',
    privacy_title: 'Privacy policy',
    privacy_text_1:
      'Site owner: private individual (LXBE/Alex). Purpose: manage booking and contact requests.',
    privacy_text_2:
      'Processed data: name, email, company/promoter and message. Legal basis: user consent.',
    privacy_text_3:
      'Recipients: FormSubmit for form delivery and hosting providers. You can exercise your rights by email.',
    cookies_title: 'Cookie policy',
    cookies_text_1:
      'This site uses necessary technical cookies and, with consent, third-party embeds (Instagram/SoundCloud) that may set additional cookies.',
    cookies_text_2:
      'You can accept or reject non-essential cookies from the banner and change your choice any time.',
    notice_title: 'Legal notice',
    notice_text_1:
      'Informational and artistic promotion website run by a private individual. Using this site implies acceptance of these terms and applicable law.',
    notice_text_2: 'Legal/privacy contact: hello.alexbemusic@gmail.com.',
    cookie_banner_text:
      'We use technical cookies and, with your permission, load third-party embeds (Instagram/SoundCloud).',
    cookie_accept: 'Accept',
    cookie_reject: 'Reject',
    cookie_manage: 'Manage cookies',
    embed_blocked: 'Content blocked until third-party cookies are accepted.',
    embed_open_original: 'Open original',
    footer_privacy: 'Privacy',
    footer_cookies: 'Cookies',
    footer_notice: 'Legal notice',
    footer_top: 'Back to top',
    footer_copy: 'LXBE 路 Official Presskit',
    onesheet_filename: 'LXBE_OneSheet_EN.html',
    onesheet_subtitle: 'Official presskit',
  },
};

const LANG_STORAGE_KEY = 'lxbe_lang';
const COOKIE_CONSENT_KEY = 'lxbe_cookie_consent';
const INSTAGRAM_PROFILE_URL = 'https://www.instagram.com/alexbemusic/';
const SOUNDCLOUD_PROFILE_URL = 'https://soundcloud.com/alexbemusic';
const INSTAGRAM_POSTS = [
  {
    url: 'https://www.instagram.com/p/DURKYgRkkWh/',
    flag: '仇',
    location: { es: 'Auckland, Nueva Zelanda', en: 'Auckland, New Zealand' },
    venue: 'Auckland DJ Set',
  },
  {
    url: 'https://www.instagram.com/p/DUI9i6jjJUW/',
    flag: '仇',
    location: { es: 'Auckland, Nueva Zelanda', en: 'Auckland, New Zealand' },
    venue: 'Auckland DJ Set',
  },
  {
    url: 'https://www.instagram.com/p/DRFXb-0gl5H/',
    flag: '',
    location: { es: 'Barcelona, Espa帽a', en: 'Barcelona, Spain' },
    venue: 'The Players Club',
  },
  {
    url: 'https://www.instagram.com/p/DR5Op0ZApVb/',
    flag: '',
    location: { es: 'Barcelona, Espa帽a', en: 'Barcelona, Spain' },
    venue: 'Barcelona Club Set',
  },
  {
    url: 'https://www.instagram.com/p/DM6Cs5MNwS3/?img_index=3',
    flag: '',
    location: { es: 'Barcelona, Espa帽a', en: 'Barcelona, Spain' },
    venue: 'Barcelona Club Set',
  },
  {
    url: 'https://www.instagram.com/reel/DKaFWpBM932/',
    flag: '',
    location: { es: 'Barcelona, Espa帽a', en: 'Barcelona, Spain' },
    venue: 'Southern Cross',
  },
  {
    url: 'https://www.instagram.com/reel/DJO0MpytG5A/',
    flag: '',
    location: { es: 'Barcelona, Espa帽a', en: 'Barcelona, Spain' },
    venue: 'The Junction',
  },
  {
    url: 'https://www.instagram.com/reel/DA39X78t0Af/',
    flag: '',
    location: { es: 'Barcelona, Espa帽a', en: 'Barcelona, Spain' },
    venue: 'Panoramic',
  },
  {
    url: 'https://www.instagram.com/p/C_JOJh-Nxix/?img_index=3',
    flag: '吼',
    location: { es: 'Nueva York, Estados Unidos', en: 'New York, United States' },
    venue: 'The Highlight Room',
  },
];
let currentLang = 'es';
let cookieConsent = 'unknown';

const setMetaContent = (selector, value) => {
  const tag = document.querySelector(selector);
  if (tag) tag.setAttribute('content', value);
};

const hasThirdPartyConsent = () => cookieConsent === 'accepted';

const updateThirdPartyEmbeds = () => {
  const dict = translations[currentLang] || translations.en;

  document.querySelectorAll('iframe[data-consent-src]').forEach((frame) => {
    if (hasThirdPartyConsent()) {
      frame.src = frame.dataset.consentSrc || '';
      frame.classList.remove('is-blocked');
      frame.removeAttribute('data-blocked-label');
    } else {
      frame.removeAttribute('src');
      frame.classList.add('is-blocked');
      frame.setAttribute('data-blocked-label', dict.embed_blocked);
    }
  });
};

const applyTranslations = (lang) => {
  const dict = translations[lang] || translations.es;
  currentLang = lang;

  document.documentElement.lang = lang;
  document.title = dict.page_title;
  setMetaContent('meta[name="description"]', dict.page_description);
  setMetaContent('meta[property="og:title"]', dict.og_title);
  setMetaContent('meta[property="og:description"]', dict.og_description);

  document.querySelectorAll('[data-i18n]').forEach((node) => {
    const key = node.dataset.i18n;
    if (dict[key]) node.textContent = dict[key];
  });

  document.querySelectorAll('[data-i18n-attr]').forEach((node) => {
    const rule = node.dataset.i18nAttr;
    if (!rule) return;

    rule.split('|').forEach((pair) => {
      const [attr, key] = pair.split(':').map((item) => item.trim());
      if (!attr || !key || !dict[key]) return;
      node.setAttribute(attr, dict[key]);
    });
  });

  const year = new Date().getFullYear();
  const footerCopy = document.getElementById('footer-copy');
  if (footerCopy) {
    footerCopy.textContent = `漏 ${year} ${dict.footer_copy}`;
  }

  document.querySelectorAll('.lang-btn').forEach((button) => {
    const isActive = button.dataset.lang === lang;
    button.classList.toggle('is-active', isActive);
    button.setAttribute('aria-pressed', String(isActive));
  });

  renderInstagramSection();
  updateThirdPartyEmbeds();
  localStorage.setItem(LANG_STORAGE_KEY, lang);
};

const initLanguage = () => {
  const stored = localStorage.getItem(LANG_STORAGE_KEY);
  const initial = stored && translations[stored] ? stored : 'en';

  applyTranslations(initial);

  document.querySelectorAll('.lang-btn').forEach((button) => {
    button.addEventListener('click', () => {
      const lang = button.dataset.lang;
      if (!lang || !translations[lang]) return;
      applyTranslations(lang);
    });
  });
};

const initNavigation = () => {
  const toggle = document.querySelector('.nav-toggle');
  const menu = document.querySelector('.nav-menu');

  if (!toggle || !menu) return;

  menu.dataset.open = 'false';

  const closeMenu = () => {
    menu.dataset.open = 'false';
    toggle.setAttribute('aria-expanded', 'false');
  };

  toggle.addEventListener('click', () => {
    const nextOpen = menu.dataset.open !== 'true';
    menu.dataset.open = String(nextOpen);
    toggle.setAttribute('aria-expanded', String(nextOpen));
  });

  menu.querySelectorAll('a').forEach((link) => {
    link.addEventListener('click', closeMenu);
  });

  document.addEventListener('click', (event) => {
    if (!menu.contains(event.target) && !toggle.contains(event.target)) {
      closeMenu();
    }
  });
};

const activateLegalSection = (targetId = 'privacy-policy') => {
  const tabs = document.querySelectorAll('.legal-tab');
  const contents = document.querySelectorAll('[data-legal-content]');

  tabs.forEach((tab) => {
    const isActive = tab.dataset.legalTarget === targetId;
    tab.classList.toggle('is-active', isActive);
    tab.setAttribute('aria-selected', String(isActive));
  });

  contents.forEach((section) => {
    const shouldShow = section.id === targetId;
    section.hidden = !shouldShow;
  });
};

const initLegalDrawer = () => {
  const drawer = document.getElementById('legal-drawer');
  if (!drawer) return;

  const overlay = drawer.querySelector('.legal-drawer__overlay');
  const closeButtons = drawer.querySelectorAll('[data-action="close-legal"]');

  const openDrawer = (targetId) => {
    activateLegalSection(targetId);
    drawer.hidden = false;
    drawer.setAttribute('aria-hidden', 'false');
    document.body.style.overflow = 'hidden';
  };

  const closeDrawer = () => {
    drawer.hidden = true;
    drawer.setAttribute('aria-hidden', 'true');
    document.body.style.overflow = '';
  };

  document.querySelectorAll('[data-legal-link]').forEach((link) => {
    link.addEventListener('click', (event) => {
      event.preventDefault();
      const targetId = link.dataset.legalTarget || 'privacy-policy';
      openDrawer(targetId);
    });
  });

  drawer.querySelectorAll('.legal-tab').forEach((tab) => {
    tab.addEventListener('click', () => {
      const targetId = tab.dataset.legalTarget;
      activateLegalSection(targetId);
    });
  });

  closeButtons.forEach((btn) => btn.addEventListener('click', closeDrawer));
  if (overlay) overlay.addEventListener('click', closeDrawer);

  document.addEventListener('keydown', (event) => {
    if (event.key === 'Escape' && !drawer.hidden) {
      closeDrawer();
    }
  });
};

const initReveal = () => {
  const items = document.querySelectorAll('.reveal');
  if (!items.length) return;

  const reducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
  if (reducedMotion) {
    items.forEach((item) => item.classList.add('is-visible'));
    return;
  }

  const observer = new IntersectionObserver(
    (entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          entry.target.classList.add('is-visible');
          observer.unobserve(entry.target);
        }
      });
    },
    {
      threshold: 0.2,
    }
  );

  items.forEach((item) => observer.observe(item));
};

const toInstagramEmbedUrl = (url) => {
  const cleanUrl = url.split('?')[0].split('#')[0];
  if (cleanUrl.endsWith('/embed')) return cleanUrl;
  return cleanUrl.endsWith('/') ? `${cleanUrl}embed` : `${cleanUrl}/embed`;
};

const renderInstagramSection = () => {
  const container = document.getElementById('ig-embeds');
  const footprint = document.getElementById('ig-footprint');
  const profileLink = document.querySelector('.ig-profile-link');
  if (!container) return;

  if (profileLink) {
    profileLink.setAttribute('href', INSTAGRAM_PROFILE_URL);
  }

  container.innerHTML = '';
  if (footprint) {
    footprint.innerHTML = '';
  }

  if (!INSTAGRAM_POSTS.length) {
    const empty = document.createElement('p');
    empty.className = 'ig-empty';
    empty.textContent = translations[currentLang].ig_empty;
    container.appendChild(empty);
    return;
  }

  const locationMap = new Map();
  INSTAGRAM_POSTS.forEach((post) => {
    const locationText = post.location[currentLang] || post.location.en;
    const key = `${post.flag}-${locationText}`;
    if (!locationMap.has(key)) {
      locationMap.set(key, `${post.flag} ${locationText}`);
    }
  });

  if (footprint) {
    locationMap.forEach((label) => {
      const pill = document.createElement('span');
      pill.className = 'ig-pill';
      pill.textContent = label;
      footprint.appendChild(pill);
    });
  }

  INSTAGRAM_POSTS.forEach((post) => {
    const postUrl = post.url;
    const locationText = post.location[currentLang] || post.location.en;
    const card = document.createElement('article');
    card.className = 'ig-card';

    const meta = document.createElement('div');
    meta.className = 'ig-meta';

    const locationPill = document.createElement('span');
    locationPill.className = 'ig-pill';
    locationPill.textContent = `${post.flag} ${locationText}`;

    const venuePill = document.createElement('span');
    venuePill.className = 'ig-pill';
    venuePill.textContent = post.venue;

    meta.appendChild(locationPill);
    meta.appendChild(venuePill);

    const link = document.createElement('a');
    link.href = postUrl;
    link.target = '_blank';
    link.rel = 'noreferrer';
    link.textContent = hasThirdPartyConsent()
      ? translations[currentLang].ig_view_post
      : translations[currentLang].embed_open_original;

    card.appendChild(meta);
    if (hasThirdPartyConsent()) {
      const frame = document.createElement('iframe');
      frame.className = 'ig-embed';
      frame.classList.add(postUrl.includes('/reel/') ? 'is-reel' : 'is-post');
      frame.src = toInstagramEmbedUrl(postUrl);
      frame.loading = 'lazy';
      frame.referrerPolicy = 'strict-origin-when-cross-origin';
      frame.setAttribute('scrolling', 'no');
      frame.setAttribute('allowtransparency', 'true');
      frame.setAttribute('title', `${post.venue} Instagram post`);
      card.appendChild(frame);
    } else {
      const blocked = document.createElement('div');
      blocked.className = 'ig-embed ig-embed--blocked';
      blocked.textContent = translations[currentLang].embed_blocked;
      card.appendChild(blocked);
    }
    card.appendChild(link);
    container.appendChild(card);
  });
};

const initCookieConsent = () => {
  cookieConsent = localStorage.getItem(COOKIE_CONSENT_KEY) || 'unknown';
  const banner = document.getElementById('cookie-banner');
  const accept = document.querySelector('[data-action="cookie-accept"]');
  const reject = document.querySelector('[data-action="cookie-reject"]');
  const manage = document.querySelector('[data-action="cookie-manage"]');

  const applyState = (state) => {
    cookieConsent = state;
    localStorage.setItem(COOKIE_CONSENT_KEY, state);
    if (banner) banner.classList.toggle('is-visible', state === 'unknown');
    updateThirdPartyEmbeds();
    renderInstagramSection();
  };

  if (accept) {
    accept.addEventListener('click', () => applyState('accepted'));
  }
  if (reject) {
    reject.addEventListener('click', () => applyState('rejected'));
  }
  if (manage) {
    manage.addEventListener('click', () => applyState('unknown'));
  }

  applyState(cookieConsent);
};

const initPressAction = () => {
  const pressButton = document.querySelector('[data-action="press-assets"]');
  if (!pressButton) return;

  pressButton.addEventListener('click', () => {
    const subject = encodeURIComponent(translations[currentLang].press_assets_subject);
    window.location.href = `mailto:hello.alexbemusic@gmail.com?subject=${subject}`;
  });
};

const initBackToTop = () => {
  const button = document.getElementById('back-to-top');
  if (!button) return;

  const onScroll = () => {
    const shouldShow = window.scrollY > 420;
    button.classList.toggle('is-visible', shouldShow);
  };

  button.addEventListener('click', () => {
    window.scrollTo({ top: 0, behavior: 'smooth' });
  });

  window.addEventListener('scroll', onScroll, { passive: true });
  onScroll();
};

const initOneSheetDownload = () => {
  const trigger = document.querySelector('[data-action="download-onesheet"]');
  if (!trigger) return;

  trigger.addEventListener('click', () => {
    const dict = translations[currentLang] || translations.en;
    const photoUrl = new URL('photo.jpg', window.location.href).href;
    const logoWhite = new URL('LXBE%20WHITE.png', window.location.href).href;
    const logoBlack = new URL('LXBE%20BLACK.png', window.location.href).href;
    const instagramCards = INSTAGRAM_POSTS.slice(0, 6)
      .map((post) => {
        const locationText = post.location[currentLang] || post.location.en;
        return `
          <a class="link-card" href="${post.url}" target="_blank" rel="noreferrer">
            <img src="${photoUrl}" alt="LXBE press visual" />
            <div class="link-meta">
              <strong>${post.venue}</strong>
              <span>${post.flag} ${locationText}</span>
            </div>
          </a>
        `;
      })
      .join('');

    const html = `<!doctype html>
<html lang="${currentLang}">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>${dict.page_title} - One Sheet</title>
  <style>
    body{margin:0;font-family:Arial,sans-serif;background:#f6f2e9;color:#16141d}
    .sheet{max-width:900px;margin:0 auto;padding:36px}
    .hero{padding:28px;border-radius:20px;background:linear-gradient(135deg,#1f3a8a,#ff6b35);color:#fff}
    h1{margin:0}
    .logo-wrap{height:58px;display:flex;align-items:center}
    .logo-img{height:58px;display:block}
    .logo-dark{display:none}
    @media print{
      .logo-light{display:none}
      .logo-dark{display:block}
    }
    h2{margin:24px 0 10px;font-size:20px;color:#1f3a8a}
    p{line-height:1.55}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:14px}
    .box{background:#fff;border:1px solid #ddd5c8;border-radius:14px;padding:14px}
    .links-title{margin:24px 0 10px;font-size:20px;color:#1f3a8a}
    .links-grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px}
    .link-card{display:block;text-decoration:none;color:#111;border:1px solid #ddd5c8;border-radius:14px;overflow:hidden;background:#fff}
    .link-card img{width:100%;height:132px;object-fit:cover;display:block}
    .link-meta{padding:10px}
    .link-meta strong{display:block;font-size:13px}
    .link-meta span{font-size:12px;color:#5f576f}
    .meta{margin-top:18px;font-size:13px;color:#5f576f}
    @media print {.sheet{padding:12px} a{color:inherit;text-decoration:none}}
  </style>
</head>
<body>
  <div class="sheet">
    <section class="hero">
      <h1 class="logo-wrap">
        <img class="logo-img logo-light" src="${logoWhite}" alt="LXBE logo" />
        <img class="logo-img logo-dark" src="${logoBlack}" alt="LXBE logo" />
      </h1>
      <p>${dict.onesheet_subtitle} 路 Afro House 路 House 路 Funky House 路 Nu Disco</p>
    </section>
    <section>
      <h2>${dict.about_title}</h2>
      <p>${dict.bio_p1}</p>
      <p>${dict.bio_p2}</p>
      <p>${dict.bio_p3}</p>
    </section>
    <section class="grid">
      <div class="box"><h2>${dict.sound_card1_title}</h2><p>${dict.sound_card1_text}</p></div>
      <div class="box"><h2>${dict.sound_card2_title}</h2><p>${dict.sound_card2_text}</p></div>
      <div class="box"><h2>${dict.sound_card3_title}</h2><p>${dict.sound_card3_text}</p></div>
      <div class="box"><h2>${dict.contact_title}</h2><p>hello.alexbemusic@gmail.com<br/>Barcelona</p></div>
    </section>
    <h2 class="links-title">Instagram + SoundCloud</h2>
    <section class="links-grid">
      <a class="link-card" href="${SOUNDCLOUD_PROFILE_URL}" target="_blank" rel="noreferrer">
        <img src="${photoUrl}" alt="LXBE SoundCloud visual" />
        <div class="link-meta">
          <strong>SoundCloud</strong>
          <span>${SOUNDCLOUD_PROFILE_URL}</span>
        </div>
      </a>
      ${instagramCards}
    </section>
    <p class="meta">Instagram: ${INSTAGRAM_PROFILE_URL} 路 SoundCloud: ${SOUNDCLOUD_PROFILE_URL}</p>
  </div>
</body>
</html>`;

    const printWindow = window.open('about:blank', '_blank');
    if (!printWindow) {
      const fallbackBlob = new Blob([html], { type: 'text/html;charset=utf-8' });
      const fallbackUrl = URL.createObjectURL(fallbackBlob);
      const fallbackLink = document.createElement('a');
      fallbackLink.href = fallbackUrl;
      fallbackLink.download = dict.onesheet_filename;
      document.body.appendChild(fallbackLink);
      fallbackLink.click();
      fallbackLink.remove();
      URL.revokeObjectURL(fallbackUrl);
      return;
    }

    printWindow.document.open();
    printWindow.document.write(html);
    printWindow.document.close();

    setTimeout(() => {
      try {
        printWindow.focus();
        printWindow.print();
      } catch (_error) {
        // Keep window open as fallback for manual print (Cmd/Ctrl+P)
      }
    }, 550);
  });
};

document.addEventListener('DOMContentLoaded', () => {
  initCookieConsent();
  initLanguage();
  initNavigation();
  initLegalDrawer();
  initReveal();
  initPressAction();
  initBackToTop();
  initOneSheetDownload();
});
